<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6HVGXQFHWX"></script>
    <script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-6HVGXQFHWX');</script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="turbo-cache-control" content="no-cache">

    <!-- Primary Meta Tags -->
    <title>Kafka Notifications | Frinx Docs</title>
    <meta name="title" content="Kafka Notifications | Frinx Docs">
    <meta name="description" content="NETCONF devices are capable of generating NETCONF notifications. UniConfig is able to collect these notifications and creates its own" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://docs.frinx.io/frinx-uniconfig/user-guide/uniconfig-operations/kafka-notifications/">
    <meta property="og:title" content="Kafka Notifications | Frinx Docs">
    <meta property="og:description" content="NETCONF devices are capable of generating NETCONF notifications. UniConfig is able to collect these notifications and creates its own">
    <meta property="og:image" content="https://docs.frinx.io/frinx-uniconfig/user-guide/uniconfig-operations/kafka-notifications/cluster.svg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://docs.frinx.io/frinx-uniconfig/user-guide/uniconfig-operations/kafka-notifications/">
    <meta property="twitter:title" content="Kafka Notifications | Frinx Docs">
    <meta property="twitter:description" content="NETCONF devices are capable of generating NETCONF notifications. UniConfig is able to collect these notifications and creates its own">
    <meta property="twitter:image" content="https://docs.frinx.io/frinx-uniconfig/user-guide/uniconfig-operations/kafka-notifications/cluster.svg">
    
    <script>(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="/static/favicon-32x32.png" rel="icon" />
    <link href="/resources/css/retype.css?v=1.11.2.699606552899" rel="stylesheet" data-turbo-track="reload" />

    <script type="text/javascript" src="/resources/js/config.js?v=1.11.2.699606552899" defer data-turbo-track="reload"></script>
    <script type="text/javascript" src="/resources/js/retype.js?v=1.11.2" defer data-turbo-track="reload"></script>
    <script id="lunr-js" type="text/javascript" src="/resources/js/lunr.js?v=1.11.2.699606552899" defer></script>
    <script id="prism-js" type="text/javascript" src="/resources/js/prism.js?v=1.11.2.699606552899" defer></script>
</head>
    <body>
        <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
    <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>

    <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
    <div class="container relative flex items-center justify-between flex-grow pr-6 md:justify-start">
        <!-- Mobile menu button skeleton -->
        <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center flex-shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px flex-shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
        <div v-cloak id="docs-sidebar-toggle"></div>

        <!-- Logo -->
        <div class="flex items-center justify-between h-full py-2 md:w-75">
            <div class="flex items-center px-2 md:px-6">
                <a id="docs-site-logo" href="/" class="flex items-center leading-snug text-2xl">
                    <span class="flex-grow-0 flex-shrink-0 overflow-hidden">
                        <img class="max-h-10 dark:hidden md:inline-block" src="/static/frinx_logo.png">
                        <img class="max-h-10 hidden dark:inline-block" src="/static/frinx_logo.png">
                    </span>
                </a>
            </div>

            <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
        </div>

        <div class="flex justify-between md:flex-grow">
            <!-- Top Nav -->
            <nav class="hidden md:flex">
    <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
        <li class="md:mr-6">
            <a class="inline-flex items-center py-2 md:mb-0 text-sm text-gray-400 whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="/">
                <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                    <g fill="currentColor">
                        <path fill-rule="evenodd" d="M11.03 2.59a1.5 1.5 0 011.94 0l7.5 6.363a1.5 1.5 0 01.53 1.144V19.5a1.5 1.5 0 01-1.5 1.5h-5.75a.75.75 0 01-.75-.75V14h-2v6.25a.75.75 0 01-.75.75H4.5A1.5 1.5 0 013 19.5v-9.403c0-.44.194-.859.53-1.144l7.5-6.363zM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 01.75-.75h3.5a.75.75 0 01.75.75v6.25h5v-9.403L12 3.734z"/>
                    </g>
                </svg>
                <span>Home</span>
            </a>
        </li>
        <li class="md:mr-6">
            <a class="inline-flex items-center py-2 md:mb-0 text-sm text-gray-400 whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://frinx.io/" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                    <g fill="currentColor">
                        <path fill-rule="evenodd" d="M0 3.75C0 2.784.784 2 1.75 2h20.5c.966 0 1.75.784 1.75 1.75v16.5A1.75 1.75 0 0122.25 22H1.75A1.75 1.75 0 010 20.25V3.75zm1.75-.25a.25.25 0 00-.25.25V5.5h4v-2H1.75zM7 3.5v2h4v-2H7zm5.5 0v2h10V3.75a.25.25 0 00-.25-.25H12.5zm10 3.5h-21v13.25c0 .138.112.25.25.25h20.5a.25.25 0 00.25-.25V7z"/>
                    </g>
                </svg>
                <span>Webpage</span>
            </a>
        </li>
        <li class="md:mr-6">
            <a class="inline-flex items-center py-2 md:mb-0 text-sm text-gray-400 whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/FRINXio" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                    <g fill="currentColor">
                        <symbol id="mark-github-icon-symbol" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></symbol><use xlink:href="#mark-github-icon-symbol" />
                    </g>
                </svg>
                <span>GitHub</span>
            </a>
        </li>
        <li class="md:mr-6">
            <a class="inline-flex items-center py-2 md:mb-0 text-sm text-gray-400 whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://www.linkedin.com/company/frinx" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                    <g fill="currentColor">
                        <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-.139 9.237c.209 4.617-3.234 9.765-9.33 9.765-1.854 0-3.579-.543-5.032-1.475 1.742.205 3.48-.278 4.86-1.359-1.437-.027-2.649-.976-3.066-2.28.515.098 1.021.069 1.482-.056-1.579-.317-2.668-1.739-2.633-3.26.442.246.949.394 1.486.411-1.461-.977-1.875-2.907-1.016-4.383 1.619 1.986 4.038 3.293 6.766 3.43-.479-2.053 1.08-4.03 3.199-4.03.943 0 1.797.398 2.395 1.037.748-.147 1.451-.42 2.086-.796-.246.767-.766 1.41-1.443 1.816.664-.08 1.297-.256 1.885-.517-.439.656-.996 1.234-1.639 1.697z"/>
                    </g>
                </svg>
                <span>LinkedIn</span>
            </a>
        </li>
    </ul>
</nav>

            <!-- Header Right Skeleton -->
            <div v-cloak class="flex justify-end flex-grow skeleton">

                <!-- Search input mock -->
                <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                    <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation"  style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                    </div>

                    <input class="w-full h-10 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 placeholder-gray-400 dark:placeholder-dark-400"
                    style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search" />
                </div>

                <!-- Mobile search button mock -->
                <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation"  style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                </div>

                <!-- Dark mode switch placehokder -->
                <div class="w-10 h-10 lg:ml-2"></div>

                <!-- History button mock -->
                <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                    <svg xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation"  style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                </div>
            </div>

            <div v-cloak class="flex items-center justify-end flex-grow">
                <div id="docs-mobile-search-button"></div>
                <doc-search-desktop></doc-search-desktop>

                <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                <doc-history></doc-history>
            </div>
        </div>
    </div>
</header>


    <div class="container relative flex bg-white">
        <!-- Sidebar Skeleton -->
<div v-cloak class="fixed flex flex-col flex-shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">

    <!-- Render this div, if config.showSidebarFilter is `true` -->
    <div class="flex items-center h-16 px-6">
        <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter" />
    </div>

    <div class="pl-6 mb-4 mt-1">
        <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
        <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
        <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
        <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
        <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
        <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
    </div>


    <div class="flex-shrink-0 mt-auto bg-transparent dark:border-dark-650">
        <a
    class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by"
    target="_blank"
    href="https://retype.com/"
    rel="noopener"
>
    <span class="text-xs whitespace-nowrap">Powered by</span>
    <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
</a>

    </div>
</div>

<!-- Sidebar component -->
<doc-sidebar v-cloak>
    <template #sidebar-footer>
        <div
            class="flex-shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650"
        >

            <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                <nav>
                    <ul class="flex flex-wrap justify-center items-center">
                        <li class="mr-6">
                            <a class="block py-1 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="/README.md">Home</a>
                        </li>
                        <li class="mr-6">
                            <a class="block py-1 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://frinx.io/">Webpage</a>
                        </li>
                        <li class="mr-6">
                            <a class="block py-1 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/FRINXio">GitHub</a>
                        </li>
                        <li class="mr-6">
                            <a class="block py-1 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://www.linkedin.com/company/frinx">LinkedIn</a>
                        </li>
                    </ul>
                </nav>
            </div>


            <a
    class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by"
    target="_blank"
    href="https://retype.com/"
    rel="noopener"
>
    <span class="text-xs whitespace-nowrap">Powered by</span>
    <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
</a>

        </div>
    </template>
</doc-sidebar>


        <div class="flex-grow min-w-0 dark:bg-dark-850">
            <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
            <div class="flex">
    <div class="flex-grow min-w-0 px-6 md:px-16">
        <main class="relative pt-6 pb-16">
            <div class="docs-markdown" id="docs-content">
                <!-- Rendered if sidebar right is enabled -->
                <div id="docs-sidebar-right-toggle"></div>
               
                <!-- Page content  -->
<doc-anchor-target id="kafka-notifications" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#kafka-notifications">#</doc-anchor-trigger>
        <span>Kafka Notifications</span>
    </h1>
</doc-anchor-target>
<doc-anchor-target id="introduction">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#introduction">#</doc-anchor-trigger>
        <span>Introduction</span>
    </h2>
</doc-anchor-target>
<p>NETCONF devices are capable of generating NETCONF notifications.
UniConfig is able to collect these notifications and creates its own
UniConfig notifications about specific events. Kafka is used for
publishing of these notifications from NETCONF devices and UniConfig.
Currently, there are these types of notifications:</p>
<ul>
<li>NETCONF notifications</li>
<li>notifications about transactions</li>
<li>audit logs (RESTCONF notifications)</li>
<li>data-change-events</li>
<li>connection notifications</li>
</ul>
<p>Each type of notifications is stored in its own topic in kafka. Besides
that, all notifications are stored in one table in database.</p>
<p><figure class="content-center">
    <img src="cluster.svg" alt="notifications-in-cluster" />
    <figcaption class="caption">notifications-in-cluster</figcaption>
</figure>
</p>
<doc-anchor-target id="kafka">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#kafka">#</doc-anchor-trigger>
        <span>Kafka</span>
    </h2>
</doc-anchor-target>
<p>Apache Kafka is a publish-subscribe based durable messaging system. A
messaging system sends messages between processes, applications, and
servers. Apache Kafka is a software where topics can be defined (think
of a topic as a category), applications can add, process and reprocess
records.</p>
<p>In our specific case UniConfig is publisher of notifications. Each type
of notifications is stored in separate topic and therefore can be
subscribed to independently. Names of topics and connection data are
configurable in lighty-uniconfig-config.json file.</p>
<doc-anchor-target id="netconf-notifications">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#netconf-notifications">#</doc-anchor-trigger>
        <span>NETCONF notifications</span>
    </h2>
</doc-anchor-target>
<p><a href="https://tools.ietf.org/html/rfc5277">RFC 5277</a> document defines a
mechanism where the NETCONF client indicates interest in receiving event
notifications from a NETCONF server by creating a subscription to
receive event notifications. The NETCONF server replies to indicate
whether the subscription request was successful and, if it was
successful, begins sending the event notifications to the NETCONF client
as the events occur within the system. These event notifications will
continue to be sent until either the NETCONF session is terminated or
the subscription terminates for some other reason.</p>
<p>NETCONF notifications have categories called streams. While subscribing
it is required to choose which streams should be received. Default
stream is called NETCONF.</p>
<doc-anchor-target id="notifications-about-transactions">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#notifications-about-transactions">#</doc-anchor-trigger>
        <span>Notifications about transactions</span>
    </h2>
</doc-anchor-target>
<p>This type of notifications is generated after each commit in UniConfig.
It contains:</p>
<ul>
<li>transaction id</li>
<li>calculate diff result</li>
<li>commit result</li>
</ul>
<doc-anchor-target id="audit-logs-restconf-notifications">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#audit-logs-restconf-notifications">#</doc-anchor-trigger>
        <span>Audit logs (RESTCONF notifications)</span>
    </h2>
</doc-anchor-target>
<p>This type of notifications is generated after each RESTCONF operation.</p>
<p><strong>It contains:</strong></p>
<ul>
<li>transaction id</li>
<li>request data
<ul>
<li>uri</li>
<li>http-method</li>
<li>source-address</li>
<li>source-port</li>
<li>query-parameters</li>
<li>user-id</li>
<li>body</li>
</ul>
</li>
<li>response data
<ul>
<li>status-code</li>
<li>query-parameters</li>
<li>body</li>
</ul>
</li>
</ul>
<p>Response body does not need to be included in notification. It can be
configured using <em>includeResponseBody</em> parameter in
lighty-uniconfig-config.json file.</p>
<doc-anchor-target id="data-change-events">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#data-change-events">#</doc-anchor-trigger>
        <span>Data-change events</span>
    </h2>
</doc-anchor-target>
<p>User must perform subscription step before data-change-events are generated and published into Kafka.
Using subscription, user specifies observed subtrees against data-changes. Afterwards, data-change-events
are generated by UniConfig instances after some transaction is committed and committed changes contain
subscribed subtrees.</p>
<p>Sample data-change-event captured by Kafka console consumer:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{
    &quot;eventTime&quot;: &quot;2022-02-14T07:36:39.55857-00:00&quot;,
    &quot;nodeId&quot;: &quot;UC-f057f8fa-8024-499a-94e9-904ce37fca78&quot;,
    &quot;streamName&quot;: &quot;DCE&quot;,
    &quot;identifier&quot;: &quot;data-change-event&quot;,
    &quot;body&quot;: {
        &quot;subscription-id&quot;: &quot;f2a786a6-eea3-419c-8341-750d388181a0&quot;,
        &quot;transaction-id&quot;: &quot;634ac8c3-c20b-4d83-a283-a31fe0bed1a6&quot;,
        &quot;edit&quot;: [
            {
                &quot;subtree-path&quot;: &quot;/process=p3&quot;,
                &quot;data-after&quot;: &quot;{\n  \&quot;process\&quot;: [\n    {\n      \&quot;uid\&quot;: \&quot;p3\&quot;\n    }\n  ]\n}&quot;
            },
            {
                &quot;subtree-path&quot;: &quot;/process=p2&quot;,
                &quot;data-before&quot;: &quot;{\n  \&quot;process\&quot;: [\n    {\n      \&quot;uid\&quot;: \&quot;p2\&quot;\n    }\n  ]\n}&quot;
            },
            {
                &quot;subtree-path&quot;: &quot;/process=p1/address/bus-size&quot;,
                &quot;data-after&quot;: &quot;{\n  \&quot;config:bus-size\&quot;: 2048\n}&quot;,
                &quot;data-before&quot;: &quot;{\n  \&quot;config:bus-size\&quot;: 1024\n}&quot;
            },
            {
                &quot;subtree-path&quot;: &quot;/process=p1/address/bus-id&quot;,
                &quot;data-after&quot;: &quot;{\n  \&quot;config:bus-id\&quot;: \&quot;0xFFFF\&quot;\n}&quot;,
                &quot;data-before&quot;: &quot;{\n  \&quot;config:bus-id\&quot;: \&quot;0x451FE\&quot;\n}&quot;
            }
        ]
    }
}</code></pre>
</doc-codeblock></div>
<p>In case of data-change-events, streamName is always &#x27;DCE&#x27; and identifier of YANG notification is &#x27;data-change-event&#x27;.
Body contains:</p>
<ul>
<li>subscription-id: Identifier of the subscription that triggers generation of data-change-event.
Subscription identifier makes association of subscriptions and received data-changes-events easier than using
combination of multiple fields such as node identifier, topology identifier, and subtree path.</li>
<li>transaction-id: Identifier of committed transaction that triggered data-change-event after commit or checked-commit
UniConfig operations.</li>
<li>edit - List of captured modifications done in the committed transaction.</li>
</ul>
<p>Edit entry fields:</p>
<ul>
<li>subtree-path: Relative path to data-tree element at which data-change happened. Path is relative to subtree-path
specified during subscription.</li>
<li>data-before: JSON representation of subtree data before done changes. If this field is not present, then &#x27;data-after&#x27;
represents created data.</li>
<li>data-after: JSON representation of subtree data including done changes. If this fields is not present, then
&#x27;data-before&#x27; represents removed data.</li>
</ul>
<doc-anchor-target id="connection-notifications">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#connection-notifications">#</doc-anchor-trigger>
        <span>Connection notifications</span>
    </h2>
</doc-anchor-target>
<p>Connection notification are generated whenever status of some node changes.
For connection notifications, streamName is always &#x27;CONNECTION&#x27; and identifier of YANG notification is &#x27;connection-notification&#x27;.</p>
<p>It contains:</p>
<ul>
<li>topology id</li>
<li>node id</li>
<li>connection status</li>
<li>connection message</li>
</ul>
<p>Supported topologies are cli, netconf and gnmi.</p>
<p>Sample connection notifications captured by Kafka console consumer:</p>
<p><strong>CLI disconnect notification:</strong></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{&quot;eventTime&quot;:&quot;2022-02-17T10:09:28.76615-00:00&quot;,&quot;nodeId&quot;:&quot;UC-5b4d0cec-6493-4e3d-bd1c-348a3ce83600&quot;,&quot;streamName&quot;:&quot;CONNECTION&quot;,&quot;identifier&quot;:&quot;connection-notification&quot;,&quot;body&quot;:{&quot;connection-status&quot;:&quot;disconnected&quot;,&quot;node-id&quot;:&quot;R1&quot;,&quot;connection-message&quot;:&quot;&quot;,&quot;topology&quot;:&quot;cli&quot;}}</code></pre>
</doc-codeblock></div>
<p><strong>NETCONF connect notification:</strong></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{&quot;eventTime&quot;:&quot;2022-02-17T10:09:51.41777-00:00&quot;,&quot;nodeId&quot;:&quot;UC-5b4d0cec-6493-4e3d-bd1c-348a3ce83600&quot;,&quot;streamName&quot;:&quot;CONNECTION&quot;,&quot;identifier&quot;:&quot;connection-notification&quot;,&quot;body&quot;:{&quot;connection-status&quot;:&quot;connecting&quot;,&quot;node-id&quot;:&quot;R2&quot;,&quot;connection-message&quot;:&quot;Connecting&quot;,&quot;topology&quot;:&quot;topology-netconf&quot;}}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="database-entities">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#database-entities">#</doc-anchor-trigger>
        <span>Database entities</span>
    </h2>
</doc-anchor-target>
<p>There are three tables related to notifications in database:</p>
<ul>
<li>notification</li>
<li>settings</li>
<li>netconf-subscription</li>
</ul>
<p>Notifications are stored in notification table. It has these columns:</p>
<ul>
<li>stream name - name of the notification stream - NETCONF stream name or UniConfig-specific stream name</li>
<li>node id - node id of the NETCONF device for NETCONF notifications or identifier of UniConfig instance in case of other
types of notifications</li>
<li>identifier - name of the YANG notification</li>
<li>body - full notification body in JSON format</li>
<li>event time - time when notification was generated</li>
</ul>
<p>Example request for reading notifications using RESTCONF:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">Request</div>
<pre class="language-bash"><code v-pre class="language-bash">curl --location --request GET 'http://localhost:8181/rests/data/notifications:notification' \
--header 'Accept: application/json' \
--header 'Content-Type: application/json'</code></pre>
</doc-codeblock></div>
<p>Settings table has 2 columns: identifier and config. Record with
identifier kafka contains configuration for kafka that can be modified
at runtime.</p>
<p>Example request for reading kafka settings using RESTCONF:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">Request</div>
<pre class="language-bash"><code v-pre class="language-bash">curl --location --request GET 'http://localhost:8181/rests/data/kafka-brokers:kafka-settings' \
--header 'Accept: application/json' \
--header 'Content-Type: application/json'</code></pre>
</doc-codeblock></div>
<p>NETCONF subscription table is used to track NETCONF notification
subscriptions. It has the following columns:</p>
<ul>
<li>node id - id of the NETCONF node from which notifications should be collected</li>
<li>UniConfig instance id - instance id of UniConfig that is collecting notifications from the NETCONF device</li>
<li>stream name - NETCONF stream name</li>
<li>creation time - time when subscription was created</li>
<li>start time - time when notifications start to be collected</li>
<li>end time - time when notifications stop to be collected</li>
</ul>
<p>Example request for reading subscriptions using RESTCONF:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">Request</div>
<pre class="language-bash"><code v-pre class="language-bash">curl --location --request GET 'http://localhost:8181/rests/data/netconf-subscriptions:netconf-subscriptions' \
--header 'Accept: application/json' \
--header 'Content-Type: application/json'</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="netconf-subscriptions">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#netconf-subscriptions">#</doc-anchor-trigger>
        <span>NETCONF subscriptions</span>
    </h2>
</doc-anchor-target>
<p>To receive NETCONF notifications from NETCONF device it is necessary to
create subscription. Subscription is created using install request:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">Request</div>
<pre class="language-bash"><code v-pre class="language-bash">curl --location --request POST 'http://localhost:8181/rests/operations/connection-manager:install-node' \
--header 'Accept: application/json' \
--header 'Content-Type: application/json' \
--data-raw '{
    &quot;input&quot;:{
        &quot;node-id&quot;:&quot;versa_2&quot;,
        &quot;netconf&quot;:{
            &quot;netconf-node-topology:host&quot;:&quot;10.103.5.202&quot;,
            &quot;netconf-node-topology:port&quot;:2022,
            &quot;netconf-node-topology:keepalive-delay&quot;:5,
            &quot;netconf-node-topology:max-connection-attempts&quot;:1,
            &quot;netconf-node-topology:connection-timeout-millis&quot;:60000,
            &quot;netconf-node-topology:default-request-timeout-millis&quot;:60000,
            &quot;netconf-node-topology:tcp-only&quot;:false,
            &quot;netconf-node-topology:username&quot;:&quot;admin&quot;,
            &quot;netconf-node-topology:password&quot;:&quot;versa123&quot;,
            &quot;netconf-node-topology:sleep-factor&quot;:1.0,
            &quot;uniconfig-config:UniConfig-native-enabled&quot;:true,
            &quot;netconf-node-topology:edit-config-test-option&quot;:&quot;set&quot;,
            &quot;uniconfig-config:blacklist&quot;:{
                &quot;extension&quot;:[
                    &quot;tailf:display-when false&quot;
                ]
            },
            &quot;stream&quot;:[
                {
                    &quot;stream-name&quot;:&quot;NETCONF&quot;,
                    &quot;start-time&quot;:&quot;2021-11-08T02:00:00+00:00&quot;,
                    &quot;stop-time&quot;:&quot;2021-11-08T22:00:00+00:00&quot;
                },
                {
                    &quot;stream-name&quot;:&quot;oam&quot;
                }
            ]
        }
    }
}'</code></pre>
</doc-codeblock></div>
<p>Subscriptions to notification streams are defined as list with name
<em>stream</em>. There is one record for each stream. The only required
parameter is <em>stream-name</em>. Besides the required <em>stream-name</em>
parameter, this record also supports optional parameters:</p>
<ul>
<li><em>start-time</em> - must be specified if user wants to enable replay and
it should start at the time specified.</li>
<li><em>stop time</em> - used with the optional replay feature to indicate the
newest notifications of interest. If stopTime is not present, the
notifications will continue until the subscription is terminated.
Must be used with and be later than <em>start-time</em>. Values in the
future are valid.</li>
</ul>
<div class="flex mb-6">
    <div class="flex-shrink-0 w-1 rounded-tl rounded-bl bg-blue-500 dark:bg-blue-400"></div>
    <div class="flex w-full py-4 border border-l-0 border-gray-300 rounded-tr rounded-br doc-alert bg-white dark:bg-dark-700 dark:border-dark-700" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-blue-500 dark:text-blue-400" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3">
<p>Creation of new subscription for the stream will terminate all
existing subscriptions for this stream.</p>
        </div>
    </div>
</div>
<doc-anchor-target id="monitoring-system---processing-netconf-subscriptions">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#monitoring-system---processing-netconf-subscriptions">#</doc-anchor-trigger>
        <span>Monitoring system - processing NETCONF subscriptions</span>
    </h2>
</doc-anchor-target>
<p>Inside UniConfig, NETCONF notification subscriptions are processed in an
infinite loop within monitoring system. An iteration of the monitoring
system loop consists of following steps:</p>
<ol>
<li><p>Check global setting for NETCONF notifications</p>
<ul>
<li>If turned off, release all NETCONF subscriptions and end current iteration</li>
</ul>
</li>
<li><p>Release cancelled subscriptions</p>
</li>
<li><p>Query free subscriptions from DB and for each:</p>
<ol>
<li>create notification session (create mountpoint and register listeners)</li>
<li>lock subscription (set UniConfig instance)</li>
</ol>
</li>
</ol>
<div class="flex mb-6">
    <div class="flex-shrink-0 w-1 rounded-tl rounded-bl bg-blue-500 dark:bg-blue-400"></div>
    <div class="flex w-full py-4 border border-l-0 border-gray-300 rounded-tr rounded-br doc-alert bg-white dark:bg-dark-700 dark:border-dark-700" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-blue-500 dark:text-blue-400" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3">
<p>There is a hard limit for how many sessions can a single UniConfig node
handle. In case this limit is reached, UniConfig node refuses to acquire
additional subscriptions.</p>
        </div>
    </div>
</div>
<p>Loop interval, hard subscription limit and maximum number of
subscriptions processed per interval can be set in
lighty-uniconfig-config.json file.</p>
<doc-anchor-target id="dedicated-netconf-session-for-subscription">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#dedicated-netconf-session-for-subscription">#</doc-anchor-trigger>
        <span>Dedicated NETCONF session for subscription</span>
    </h3>
</doc-anchor-target>
<p>NETCONF device may have the :interleave capability that indicates
support to interleave other NETCONF operations within a notification
subscription. This means the NETCONF server can receive, process, and
respond to NETCONF requests on a session with an active notification
subscription. However, not all devices support this capability, so the
common approach for devices &#x27;with&#x27; and &#x27;without&#x27; interleave
capability is to track notifications with a separate NETCONF session. In
order to support this functionality, UniConfig will create a separate
NETCONF session with a separate mount-point for every subscription.
These mount points and sessions are destroyed automatically when the
corresponding subscription is closed.</p>
<p><figure class="content-center">
    <img src="monitoring.svg" alt="monitoring-system" />
    <figcaption class="caption">monitoring-system</figcaption>
</figure>
</p>
<doc-anchor-target id="clustering-of-netconf-subscriptions-and-notifications">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#clustering-of-netconf-subscriptions-and-notifications">#</doc-anchor-trigger>
        <span>Clustering of NETCONF subscriptions and notifications</span>
    </h2>
</doc-anchor-target>
<p>When device is installed with stream property set, subscriptions for all
provided streams are created in database. These subscriptions are always
created with UniConfig instance id set to null, so they can be acquired
by any UniConfig from cluster. Each UniConfig instance in cluster uses
its own monitoring system to acquire free subscriptions. Monitoring
system uses specialized transaction to lock subscriptions which prevents
more UniConfig instances to lock same subscriptions. While locking
subscription, UniConfig instance writes its id to subscription table to
currently locked subscription and which means that this subscription is
already acquired by this UniConfig instance. Other instances of
UniConfig will not find this subscription as free anymore.</p>
<doc-anchor-target id="optimal-subscription-count-and-rebalancing">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#optimal-subscription-count-and-rebalancing">#</doc-anchor-trigger>
        <span>Optimal subscription count and rebalancing</span>
    </h3>
</doc-anchor-target>
<p>With multiple UniConfig instances working in a cluster, each instance
calculates an optimal range of subscriptions to manage.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">OPTIMAL_RANGE_LOW = (NUMBER_OF_ALL_SUBSCRIPTIONS / NUMBER_OF_LIVE_UC_NODES_IN_CLUSTER) * OPTIMAL_NETCONF_SUBSCRIPTIONS_APPROACHING_MARGIN
OPTIMAL_RANGE_HIGH = (NUMBER_OF_ALL_SUBSCRIPTIONS / NUMBER_OF_LIVE_UC_NODES_IN_CLUSTER) * OPTIMAL_NETCONF_SUBSCRIPTIONS_REACHED_MARGIN
# Example: optimal range for 5000 subscriptions with 3 nodes in the cluster and margins set to 0.05 and 0.10 = (1750, 1834)</code></pre>
</doc-codeblock></div>
<p>Based on optimal range and a number of currently opened subscriptions,
each UniConfig node (while performing a monitoring system iteration)
decides whether it should:</p>
<ul>
<li>Acquire additional subscriptions before optimal range is reached</li>
<li>Stay put and not acquire additional subscriptions in case optimal range is reached</li>
<li>Release some of its subscriptions to trigger rebalancing until optimal range is reached</li>
</ul>
<p>When an instance goes down, all of its subscriptions will be immediately
released and the optimal range for the other living nodes will change
and thus the subscriptions will be reopened by the rest of the cluster.</p>
<div class="flex mb-6">
    <div class="flex-shrink-0 w-1 rounded-tl rounded-bl bg-blue-500 dark:bg-blue-400"></div>
    <div class="flex w-full py-4 border border-l-0 border-gray-300 rounded-tr rounded-br doc-alert bg-white dark:bg-dark-700 dark:border-dark-700" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-blue-500 dark:text-blue-400" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3">
<p>There is a grace period before the other nodes take over the
subscriptions. So in case a node goes down and up quickly, it will
restart the subscriptions on its own.</p>
        </div>
    </div>
</div>
<p>Following example illustrates a timeline of a 3 node cluster and how
many subscriptions each node handles:</p>
<p><figure class="content-center">
    <img src="netconf_subs_rebalancing.svg" alt="notifications-in-cluster-rebalancing" />
    <figcaption class="caption">notifications-in-cluster-rebalancing</figcaption>
</figure>
</p>
<div class="flex mb-6">
    <div class="flex-shrink-0 w-1 rounded-tl rounded-bl bg-blue-500 dark:bg-blue-400"></div>
    <div class="flex w-full py-4 border border-l-0 border-gray-300 rounded-tr rounded-br doc-alert bg-white dark:bg-dark-700 dark:border-dark-700" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-blue-500 dark:text-blue-400" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3">
<p>The hard limit still applies in clustered environment and it will never
be crossed, regardless of the optimal range.</p>
        </div>
    </div>
</div>
<doc-anchor-target id="subscription-to-data-change-events">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#subscription-to-data-change-events">#</doc-anchor-trigger>
        <span>Subscription to data-change events</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="creation-of-new-subscription">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#creation-of-new-subscription">#</doc-anchor-trigger>
        <span>Creation of new subscription</span>
    </h3>
</doc-anchor-target>
<p>Subscription to data-change-events can be created using &#x27;create-data-change-subscription&#x27; RPC. After subscription
is done, UniConfig starts to listen to data-change-events on selected nodes and subtrees, and distribute corresponding
messages to dedicated Kafka topic.</p>
<p>RPC input contains:</p>
<ul>
<li>node-id: Identifier of node from which data-change-events are generated.</li>
<li>topology-id: Identifier of topology where specified node is placed.</li>
<li>subtree-path: Path to subtree from which user would like to receive data-change-events. Default path equals to &#x27;/&#x27;</li>
<li>captured data-change-events from whole node configuration.</li>
<li>data-change-scope: Data-tree scope that specified how granular data-change-events should be captured and propagated
to Kafka. There are 3 options (&#x27;SUBTREE&#x27; is default value):
<ul>
<li>&#x27;SUBTREE&#x27;: Represents a change of the node or any of or any of its child nodes, direct and nested.
This scope is superset of ONE and BASE.</li>
<li>&#x27;ONE&#x27;: Represent a change (addition, replacement, or deletion) of the node on the subtree-path or one of its direct
children elements.</li>
<li>&#x27;BASE&#x27;: Represents only a direct change of the node on subtree-path, such as replacement of a node,
addition or deletion.</li>
</ul>
</li>
</ul>
<p>RPC output contains only generated &#x27;subscription-id&#x27; in format of UUID. This subscription identifier represents token
that can be used by user:</p>
<ul>
<li>displaying information about created subscription using RPC</li>
<li>deleting existing subscription</li>
<li>sorting received Kafka messages</li>
</ul>
<p>Example: creation of subscription to node &#x27;device1&#x27; from &#x27;uniconfig&#x27; topology and to whole configuration
subtree &#x27;/interfaces&#x27;.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">RPC Request</div>
<pre class="language-bash"><code v-pre class="language-bash">curl --location --request POST 'http://127.0.0.1:8181/rests/operations/data-change-events:create-data-change-subscription' \
--header 'Content-Type: application/json' \
--data-raw '{
    &quot;input&quot;: {
        &quot;node-id&quot;: &quot;device1&quot;,
        &quot;topology-id&quot;: &quot;uniconfig&quot;,
        &quot;subtree-path&quot;: &quot;/interfaces&quot;,
        &quot;data-change-scope&quot;: &quot;SUBTREE&quot;
    }
}'</code></pre>
</doc-codeblock></div>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">RPC response</div>
<pre class="language-json"><code v-pre class="language-json">{
  &quot;output&quot;: {
    &quot;subscription-id&quot;: &quot;8e82453d-4ea8-4c26-a74e-50d855a721fa&quot;
  }
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="removal-of-subscription">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#removal-of-subscription">#</doc-anchor-trigger>
        <span>Removal of subscription</span>
    </h3>
</doc-anchor-target>
<p>Existing subscription can be removed using &#x27;delete-data-change-subscription&#x27; RPC and provided subscription-id.
After subscription is removed, UniConfig stops generation of new data-change-events related to subscribed path.</p>
<p>RPC input contains only &#x27;subscription-id&#x27; - unique identifier of subscription to data-change-events. RPC output
doesn&#x27;t contain body. RPC will return 404, if subscription with provided identifier doesn&#x27;t exist.</p>
<p>Example: removal of subscription with ID &#x27;8e82453d-4ea8-4c26-a74e-50d855a721fa&#x27;:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">RPC Request</div>
<pre class="language-bash"><code v-pre class="language-bash">curl --location --request POST 'http://127.0.0.1:8181/rests/operations/data-change-events:delete-data-change-subscription' \
--header 'Content-Type: application/json' \
--data-raw '{
  &quot;output&quot;: {
    &quot;subscription-id&quot;: &quot;8e82453d-4ea8-4c26-a74e-50d855a721fa&quot;
  }
}'</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="showing-information-about-subscription">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#showing-information-about-subscription">#</doc-anchor-trigger>
        <span>Showing information about subscription</span>
    </h3>
</doc-anchor-target>
<p>The RPC &#x27;show-subscription-data&#x27; can be used for displaying information about created subscription. RPC input contains
identifier of target subscription.</p>
<p>RPC output for existing subscription contains &#x27;topology-id&#x27;, &#x27;node-id&#x27;, &#x27;subtree-path&#x27;, and &#x27;data-change-scope&#x27; - the
same fields that can also be specified in the &#x27;create-data-change-subscription&#x27; RPC input.
If subscription with specified ID doesn&#x27;t exist, RPC will return 404 status code with standard RESTCONF error container.</p>
<p>Example: showing information about</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">RPC Request</div>
<pre class="language-bash"><code v-pre class="language-bash">curl --location --request POST 'http://127.0.0.1:8181/rests/operations/data-change-events:show-subscription-data' \
--header 'Content-Type: application/json' \
--data-raw '{
  &quot;output&quot;: {
    &quot;subscription-id&quot;: &quot;8e82453d-4ea8-4c26-a74e-50d855a721fa&quot;
  }
}'</code></pre>
</doc-codeblock></div>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">RPC response</div>
<pre class="language-json"><code v-pre class="language-json">{
    &quot;output&quot;: {
        &quot;subtree-path&quot;: &quot;/interfaces&quot;,
        &quot;topology-id&quot;: &quot;uniconfig&quot;,
        &quot;data-change-scope&quot;: &quot;SUBTREE&quot;,
        &quot;node-id&quot;: &quot;device1&quot;
    }
}</code></pre>
</doc-codeblock></div>
<p>It is also possible to fetch all created subscriptions under specific node by sending GET request
to &#x27;data-change-subscriptions&#x27; list under &#x27;node&#x27; list item (operational data).</p>
<p>Example (there are 2 subscriptions under &#x27;device1&#x27; node):</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">GET request</div>
<pre class="language-bash"><code v-pre class="language-bash">curl --location --request GET 'http://127.0.0.1:8181/rests/data/network-topology:network-topology/topology=uniconfig/node=device1/data-change-subscriptions?content=nonconfig' \
--header 'Accept: application/json'</code></pre>
</doc-codeblock></div>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">GET response</div>
<pre class="language-json"><code v-pre class="language-json">{
    &quot;data-change-events:data-change-subscriptions&quot;: [
        {
            &quot;subscription-id&quot;: &quot;8e82453d-4ea8-4c26-a74e-50d855a721fa&quot;,
            &quot;subtree-path&quot;: &quot;/interfaces&quot;,
            &quot;data-change-scope&quot;: &quot;SUBTREE&quot;
        },
        {
            &quot;subscription-id&quot;: &quot;3b3ad917-f1a1-4cc4-83b9-3c8b62929b81&quot;,
            &quot;subtree-path&quot;: &quot;/ospf&quot;,
            &quot;data-change-scope&quot;: &quot;ONE&quot;
        }
    ]
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="configuration">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#configuration">#</doc-anchor-trigger>
        <span>Configuration</span>
    </h2>
</doc-anchor-target>
<p>Configuration for notifications is in lighty-uniconfig-config.json file
under <em>notifications</em> property. Whole configuration looks like this:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{
  &quot;notifications&quot;: {
    &quot;enabled&quot;: true,
    &quot;kafka&quot;: {
      &quot;username&quot;: &quot;kafka&quot;,
      &quot;password&quot;: &quot;kafka&quot;,
      &quot;kafkaServers&quot;: [
        {
          &quot;brokerHost&quot;: &quot;127.0.0.1&quot;,
          &quot;brokerListeningPort&quot;: 9092
        }
      ],
      &quot;netconfNotificationsEnabled&quot;: true,
      &quot;auditLogsEnabled&quot;: true,
      &quot;transactionNotificationsEnabled&quot;: true,
      &quot;dataChangeEventsEnabled&quot;: true,
      &quot;netconfNotificationsTopicName&quot;: &quot;netconf-notifications&quot;,
      &quot;auditLogsTopicName&quot;: &quot;auditLogs&quot;,
      &quot;transactionsTopicName&quot;: &quot;transactions&quot;,
      &quot;dataChangeEventsTopicName&quot;: &quot;data-change-events&quot;,
      &quot;blockingTimeout&quot;: 60000,
      &quot;requestTimeout&quot;: 30000,
      &quot;deliveryTimeout&quot;: 120000,
      &quot;maxThreadPoolSize&quot;: 8,
      &quot;queueCapacity&quot;: 2048,
      &quot;embeddedKafka&quot;: {
        &quot;enabled&quot;: true,
        &quot;installDir&quot;: &quot;/tmp/embedded-kafka&quot;,
        &quot;archiveUrl&quot;: &quot;https://dlcdn.apache.org/kafka/3.0.0/kafka_2.12-3.0.0.tgz&quot;,
        &quot;dataDir&quot;: &quot;./data/embedded-kafka&quot;,
        &quot;cleanDataBeforeStart&quot;: true,
        &quot;partitions&quot;: 1
      }
    },
    &quot;auditLogs&quot;: {
      &quot;includeResponseBody&quot;: true
    },
    &quot;notificationDbTreshold&quot;: {
      &quot;maxCount&quot;: 10000,
      &quot;maxAge&quot;: 100
    },
    &quot;netconfSubscriptionsMonitoringInterval&quot;: 5,
    &quot;maxNetconfSubscriptionsPerInterval&quot;: 10,
    &quot;maxNetconfSubscriptionsHardLimit&quot;: 5000,
    &quot;rebalanceOnUCNodeGoingDownGracePeriod&quot;: 120,
    &quot;optimalNetconfSubscriptionsApproachingMargin&quot;: 0.05,
    &quot;optimalNetconfSubscriptionsReachedMargin&quot; : 0.10
  }
}</code></pre>
</doc-codeblock></div>
<p>All notifications and also monitoring system can be enabled and disabled
by <em>enabled</em> flag.</p>
<p><strong>There are 3 properties related to monitoring system:</strong></p>
<ul>
<li>subscriptionsMonitoringInterval - how often is monitoring system
loop running and trying to acquire free subscriptions, value is in
seconds and default is 5</li>
<li>maxSubscriptionsPerInterval - maximum number of free subscriptions
that can be acquired in single monitoring system loop iteration,
when there is fewer free subscription than this value, only this
smaller amount will be processed (even zero if there are none), if
the number of free subscriptions is higher or equal to this value,
only specified amount will be acquired, the rest can be acquired
in next iterations of monitoring system loop or by other UniConfig
instances in cluster, default value for this property is 10</li>
<li>maxNetconfSubscriptionsHardLimit - hard limit for how many
subscriptions can a single UniConfig node handle</li>
</ul>
<p><strong>There are 3 properties related to monitoring system in clustered
environment:</strong></p>
<ul>
<li>rebalanceOnUCNodeGoingDownGracePeriod - grace period for a
UniConfig node going down. Other nodes will not restart the
subscriptions until the grace period passes from when a dead
Uniconfig node has been seen last. Default = 120 seconds.</li>
<li>optimalNetconfSubscriptionsApproachingMargin - the lower margin to
calculate optimal range start. Default = 0.05</li>
<li>optimalNetconfSubscriptionsReachedMargin - the higher margin to
calculate optimal range end. Default = 0.10</li>
</ul>
<p><strong>There are three properties related to the timeout of messages to Kafka</strong></p>
<ul>
<li>blockingTimeout - configuration of how long the <strong>send()</strong> method and the
creation of connection for reading of metadata methods will block (in ms).</li>
<li>requestTimeout - configuration of how long will the producer wait for
the acknowledgement of a request (in ms). If the acknowledgement
is not received before the timeout elapses, the producer will resend
the request or fail the request if retries are exhausted.</li>
<li>deliveryTimeout - configuration of the upper bound on the time to report
success or failure after a call to <strong>send()</strong> returns (in ms). This limits
the total time that a record will be delayed prior to sending, the
time to await acknowledgement from the broker (if expected), and the
time allowed for retriable send failures.</li>
</ul>
<p><strong>There are two properties related to the thread pool executor which is needed to
send messages to Kafka</strong></p>
<ul>
<li>maxThreadPoolSize - the maximum thread pool size in the executor.</li>
<li>queueCapacity - the maximum capacity of the work queue in the executor.</li>
</ul>
<p><strong>There are two properties that are used to limit number of records in
database in notifications table:</strong></p>
<ul>
<li>maxCount - if number of records in notifications table exceeds
specified number then oldest record in this table will be deleted,
this way there will never be more records in database than
specified value, default is 10 000</li>
<li>maxAge - if record is older than specified value it will be
deleted, value is in hours and default is 100</li>
</ul>
<p>These properties are under <em>notificationDbTreshold</em>. Both of these are
implemented using database triggers. Triggers are running on inserts to
notifications table.</p>
<p>Audit logs settings are under auditLogs property. Currently there is
only one flag <em>includeResponseBody</em> that is used to enable or disable of
logging body of RESTCONF responses.</p>
<p>All settings related to kafka are grouped under <em>kafka</em> property. For
authentication there are <em>username</em> and <em>password</em> properties. For kafka
connection there is <em>kafkaServers</em> property. This contains list of kafka
servers as combination of <em>brokerHost</em> and <em>brokerListeningPort</em>. Broker
host can be either ip address or hostname.</p>
<p>It is possible to enable/disable each type of notifications
independently. To do that these flags are used:</p>
<ul>
<li>netconfNotificationsEnabled</li>
<li>auditLogsEnabled</li>
<li>transactionNotificationsEnabled</li>
<li>dataChangeEventsEnabled</li>
</ul>
<p>It is possible to setup names of all topics for every notification type.
This is done using:</p>
<ul>
<li>transactionsTopicName - topic name for transactions about notifications</li>
<li>netconfNotificationsTopicName - topic name for NETCONF notifications</li>
<li>auditLogsTopicName - topic name for audit logs</li>
<li>dataChangeEventsTopicName - topic name for data-change-events</li>
</ul>
<p>It is also possible to setup embedded kafka. These setting are grouped
under <em>embeddedKafka</em> property:</p>
<ul>
<li>enabled - flag that enables or disables embedded kafka</li>
<li>installDir - where should be kafka files placed</li>
<li>archiveUrl - where to download kafka from</li>
<li>dataDir - kafka data directory</li>
<li>cleanDataBeforeStart - if kafka config should be cleared before start</li>
</ul>
<p>Kafka settings are also stored in db. This way they can be changed at
runtime. This change can be done using RESTCONF or UniConfig shell.
Kafka setting are stored in settings table.</p>
<doc-anchor-target id="kafka-client---example">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#kafka-client---example">#</doc-anchor-trigger>
        <span>Kafka client - example</span>
    </h2>
</doc-anchor-target>
<p>To read notifications from kafka, it is possible to use command line
consumer. It is done by running following command in kafka installation
directory:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">bin/kafka-console-consumer.sh \
 --bootstrap-server localhost:9092 \
 --topic netconf-notifications</code></pre>
</doc-codeblock></div>
<p>It is important to have properly setup hostname, port and topic name.
Output after creation of NETCONF notification may look like this:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{
  &quot;eventTime&quot;: &quot;2021-12-03T08:16:45.75600-00:00&quot;,
  &quot;nodeId&quot;: &quot;R1&quot;,
  &quot;streamName&quot;: &quot;NETCONF&quot;,
  &quot;identifier&quot;: &quot;netconf-session-start&quot;,
  &quot;body&quot;: {
    &quot;session-id&quot;: 191,
    &quot;source-host&quot;: &quot;10.255.246.85&quot;,
    &quot;username&quot;: &quot;admin&quot;
  }
}</code></pre>
</doc-codeblock></div>




                <!-- Required only on API pages -->
                <doc-toolbar-member-filter-no-results />
            </div>

            
<nav class="flex mt-14">
    <div class="w-1/2">
        <a class="px-5 py-4 h-full flex items-center break-all md:break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="/frinx-uniconfig/user-guide/uniconfig-operations/immediate-commit-model/">
            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
            <span>
                <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Previous</span>
                <span class="block mt-1">Immediate Commit Model</span>
            </span>
        </a>
    </div>

    <div class="w-1/2">
        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-all md:break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="/frinx-uniconfig/user-guide/uniconfig-operations/templates-manager/">
            <span>
                <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Next</span>
                <span class="block mt-1">Templates Manager</span>
            </span>
            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
        </a>
    </div>
</nav>


        </main>

        <div class="border-t dark:border-dark-650 pt-6 mb-8">
            <footer class="flex flex-wrap items-center justify-between">
    <div>
        <ul class="flex flex-wrap items-center text-sm">
    <li>
        <a class="block mr-4 py-2 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200 md:mb-0" href="about.md">About</a>
    </li>
</ul>

    </div>
    <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>© Copyright 2022. <a href="https://frinx.io/">Frinx.io</a> All rights reserved.</p>
</div>
</footer>

        </div>
    </div>
    
    <!-- Rendered if sidebar right is enabled -->
    <!-- Sidebar right skeleton-->
    <div v-cloak class="fixed top-0 bottom-0 right-0 transform translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:flex-shrink-0 lg:pt-6 lg:transform-none lg:w-56 lg:z-0 md:w-72 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
        <div class="pl-5">
            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
        </div>
    </div>
    
    <!-- User should be able to hide sidebar right -->
    <doc-sidebar-right v-cloak></doc-sidebar-right>
</div>

        </div>
    </div>

    <doc-search-mobile></doc-search-mobile>
    <doc-back-to-top></doc-back-to-top>
</div>


        <div id="docs-overlay-target"></div>

        <script>window.__DOCS__ = { "title": "Kafka Notifications", icon: "file", hasPrism: true, hasMermaid: false, hasMath: false }</script>
    </body>
</html>
